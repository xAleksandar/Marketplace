{"ast":null,"code":"import { CID } from 'multiformats/cid';\nimport { decodeNode } from './pb-decode.js';\nimport { encodeNode } from './pb-encode.js';\nimport { prepare, validate, createNode, createLink } from './util.js';\nexport const name = 'dag-pb';\nexport const code = 112;\nexport function encode(node) {\n  validate(node);\n  const pbn = {};\n\n  if (node.Links) {\n    pbn.Links = node.Links.map(l => {\n      const link = {};\n\n      if (l.Hash) {\n        link.Hash = l.Hash.bytes;\n      }\n\n      if (l.Name !== undefined) {\n        link.Name = l.Name;\n      }\n\n      if (l.Tsize !== undefined) {\n        link.Tsize = l.Tsize;\n      }\n\n      return link;\n    });\n  }\n\n  if (node.Data) {\n    pbn.Data = node.Data;\n  }\n\n  return encodeNode(pbn);\n}\nexport function decode(bytes) {\n  const pbn = decodeNode(bytes);\n  const node = {};\n\n  if (pbn.Data) {\n    node.Data = pbn.Data;\n  }\n\n  if (pbn.Links) {\n    node.Links = pbn.Links.map(l => {\n      const link = {};\n\n      try {\n        link.Hash = CID.decode(l.Hash);\n      } catch (e) {}\n\n      if (!link.Hash) {\n        throw new Error('Invalid Hash field found in link, expected CID');\n      }\n\n      if (l.Name !== undefined) {\n        link.Name = l.Name;\n      }\n\n      if (l.Tsize !== undefined) {\n        link.Tsize = l.Tsize;\n      }\n\n      return link;\n    });\n  }\n\n  return node;\n}\nexport { prepare, validate, createNode, createLink };","map":{"version":3,"sources":["/home/alex/Documents/gitest/Marketplace/node_modules/@ipld/dag-pb/esm/src/index.js"],"names":["CID","decodeNode","encodeNode","prepare","validate","createNode","createLink","name","code","encode","node","pbn","Links","map","l","link","Hash","bytes","Name","undefined","Tsize","Data","decode","e","Error"],"mappings":"AAAA,SAASA,GAAT,QAAoB,kBAApB;AACA,SAASC,UAAT,QAA2B,gBAA3B;AACA,SAASC,UAAT,QAA2B,gBAA3B;AACA,SACEC,OADF,EAEEC,QAFF,EAGEC,UAHF,EAIEC,UAJF,QAKO,WALP;AAMA,OAAO,MAAMC,IAAI,GAAG,QAAb;AACP,OAAO,MAAMC,IAAI,GAAG,GAAb;AACP,OAAO,SAASC,MAAT,CAAgBC,IAAhB,EAAsB;AAC3BN,EAAAA,QAAQ,CAACM,IAAD,CAAR;AACA,QAAMC,GAAG,GAAG,EAAZ;;AACA,MAAID,IAAI,CAACE,KAAT,EAAgB;AACdD,IAAAA,GAAG,CAACC,KAAJ,GAAYF,IAAI,CAACE,KAAL,CAAWC,GAAX,CAAeC,CAAC,IAAI;AAC9B,YAAMC,IAAI,GAAG,EAAb;;AACA,UAAID,CAAC,CAACE,IAAN,EAAY;AACVD,QAAAA,IAAI,CAACC,IAAL,GAAYF,CAAC,CAACE,IAAF,CAAOC,KAAnB;AACD;;AACD,UAAIH,CAAC,CAACI,IAAF,KAAWC,SAAf,EAA0B;AACxBJ,QAAAA,IAAI,CAACG,IAAL,GAAYJ,CAAC,CAACI,IAAd;AACD;;AACD,UAAIJ,CAAC,CAACM,KAAF,KAAYD,SAAhB,EAA2B;AACzBJ,QAAAA,IAAI,CAACK,KAAL,GAAaN,CAAC,CAACM,KAAf;AACD;;AACD,aAAOL,IAAP;AACD,KAZW,CAAZ;AAaD;;AACD,MAAIL,IAAI,CAACW,IAAT,EAAe;AACbV,IAAAA,GAAG,CAACU,IAAJ,GAAWX,IAAI,CAACW,IAAhB;AACD;;AACD,SAAOnB,UAAU,CAACS,GAAD,CAAjB;AACD;AACD,OAAO,SAASW,MAAT,CAAgBL,KAAhB,EAAuB;AAC5B,QAAMN,GAAG,GAAGV,UAAU,CAACgB,KAAD,CAAtB;AACA,QAAMP,IAAI,GAAG,EAAb;;AACA,MAAIC,GAAG,CAACU,IAAR,EAAc;AACZX,IAAAA,IAAI,CAACW,IAAL,GAAYV,GAAG,CAACU,IAAhB;AACD;;AACD,MAAIV,GAAG,CAACC,KAAR,EAAe;AACbF,IAAAA,IAAI,CAACE,KAAL,GAAaD,GAAG,CAACC,KAAJ,CAAUC,GAAV,CAAcC,CAAC,IAAI;AAC9B,YAAMC,IAAI,GAAG,EAAb;;AACA,UAAI;AACFA,QAAAA,IAAI,CAACC,IAAL,GAAYhB,GAAG,CAACsB,MAAJ,CAAWR,CAAC,CAACE,IAAb,CAAZ;AACD,OAFD,CAEE,OAAOO,CAAP,EAAU,CACX;;AACD,UAAI,CAACR,IAAI,CAACC,IAAV,EAAgB;AACd,cAAM,IAAIQ,KAAJ,CAAU,gDAAV,CAAN;AACD;;AACD,UAAIV,CAAC,CAACI,IAAF,KAAWC,SAAf,EAA0B;AACxBJ,QAAAA,IAAI,CAACG,IAAL,GAAYJ,CAAC,CAACI,IAAd;AACD;;AACD,UAAIJ,CAAC,CAACM,KAAF,KAAYD,SAAhB,EAA2B;AACzBJ,QAAAA,IAAI,CAACK,KAAL,GAAaN,CAAC,CAACM,KAAf;AACD;;AACD,aAAOL,IAAP;AACD,KAhBY,CAAb;AAiBD;;AACD,SAAOL,IAAP;AACD;AACD,SACEP,OADF,EAEEC,QAFF,EAGEC,UAHF,EAIEC,UAJF","sourcesContent":["import { CID } from 'multiformats/cid';\nimport { decodeNode } from './pb-decode.js';\nimport { encodeNode } from './pb-encode.js';\nimport {\n  prepare,\n  validate,\n  createNode,\n  createLink\n} from './util.js';\nexport const name = 'dag-pb';\nexport const code = 112;\nexport function encode(node) {\n  validate(node);\n  const pbn = {};\n  if (node.Links) {\n    pbn.Links = node.Links.map(l => {\n      const link = {};\n      if (l.Hash) {\n        link.Hash = l.Hash.bytes;\n      }\n      if (l.Name !== undefined) {\n        link.Name = l.Name;\n      }\n      if (l.Tsize !== undefined) {\n        link.Tsize = l.Tsize;\n      }\n      return link;\n    });\n  }\n  if (node.Data) {\n    pbn.Data = node.Data;\n  }\n  return encodeNode(pbn);\n}\nexport function decode(bytes) {\n  const pbn = decodeNode(bytes);\n  const node = {};\n  if (pbn.Data) {\n    node.Data = pbn.Data;\n  }\n  if (pbn.Links) {\n    node.Links = pbn.Links.map(l => {\n      const link = {};\n      try {\n        link.Hash = CID.decode(l.Hash);\n      } catch (e) {\n      }\n      if (!link.Hash) {\n        throw new Error('Invalid Hash field found in link, expected CID');\n      }\n      if (l.Name !== undefined) {\n        link.Name = l.Name;\n      }\n      if (l.Tsize !== undefined) {\n        link.Tsize = l.Tsize;\n      }\n      return link;\n    });\n  }\n  return node;\n}\nexport {\n  prepare,\n  validate,\n  createNode,\n  createLink\n};"]},"metadata":{},"sourceType":"module"}